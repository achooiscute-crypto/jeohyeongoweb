<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¡œê·¸ì¸ - í•™êµ ì›¹ì‚¬ì´íŠ¸</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
      body {
        font-family: "Malgun Gothic", sans-serif;
        text-align: center;
        padding: 50px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .container {
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        color: #333;
        max-width: 500px;
        width: 100%;
      }
      button {
        padding: 15px 30px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 20px;
        background: #4285f4;
        color: white;
        border: none;
        border-radius: 8px;
        transition: all 0.3s;
      }
      button:hover {
        background: #3367d6;
        transform: translateY(-2px);
      }
      #message {
        margin-top: 20px;
      }
      .success-box {
        background: #f0f8ff;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 4px solid #4285f4;
      }
      .error-box {
        background: #ffebee;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        border-left: 4px solid #f44336;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ« í•™êµ ì›¹ì‚¬ì´íŠ¸ ë¡œê·¸ì¸</h1>
      <p>Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.</p>
      <button onclick="signInWithGoogle()">Googleë¡œ ë¡œê·¸ì¸</button>
      <div id="message"></div>
    </div>

    <script>
      // Firebase êµ¬ì„± ì •ë³´
      const firebaseConfig = {
        apiKey: "AIzaSyAYPVS5aoZLtjJW966Z6b60y75fSJgiTow",
        authDomain: "jeohyeonweb.firebaseapp.com",
        projectId: "jeohyeonweb",
        storageBucket: "jeohyeonweb.firebasestorage.app",
        messagingSenderId: "865403260673",
        appId: "1:865403260673:web:ec6c31ba874bf1787dd500",
        measurementId: "G-2ZB61M9ETS",
      };

      // Firebase ì´ˆê¸°í™”
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION);

      function signInWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.setCustomParameters({
          hd: "jeohyeon.hs.kr",
        });

        document.getElementById("message").textContent = "ë¡œê·¸ì¸ ì¤‘...";

        auth
          .signInWithPopup(provider)
          .then((result) => {
            return result.user.getIdToken();
          })
          .then((idToken) => {
            // âœ… Streamlit ì•± URL
            const streamlitAppUrl = "https://jeohyeongoweb.streamlit.app";

            document.getElementById("message").innerHTML = `
                        <div class="success-box">
                            <h3>âœ… ë¡œê·¸ì¸ ì„±ê³µ!</h3>
                            <p>3ì´ˆ í›„ ìë™ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤...</p>
                            <p>ìë™ ì´ë™ì´ ì•ˆë  ê²½ìš°:</p>
                            <button onclick="redirectToStreamlit('${idToken}')">
                                ë°”ë¡œ ì´ë™í•˜ê¸°
                            </button>
                            <button onclick="copyToken('${idToken}')" 
                                    style="background: #34a853; margin-left: 10px;">
                                í† í° ë³µì‚¬í•˜ê¸°
                            </button>
                        </div>
                    `;

            // 3ì´ˆ í›„ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸
            setTimeout(() => {
              redirectToStreamlit(idToken);
            }, 3000);
          })
          .catch((error) => {
            console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:", error);
            document.getElementById("message").innerHTML = `
                        <div class="error-box">
                            <h3>âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨</h3>
                            <p>ì˜¤ë¥˜: ${error.message}</p>
                            <button onclick="location.reload()">ë‹¤ì‹œ ì‹œë„í•˜ê¸°</button>
                        </div>
                    `;
          });
      }

      function redirectToStreamlit(token) {
        window.location.href = `https://jeohyeongoweb.streamlit.app?token=${encodeURIComponent(
          token
        )}`;
      }

      function copyToken(token) {
        navigator.clipboard.writeText(token).then(() => {
          alert(
            "í† í°ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! Streamlit ì•±ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”."
          );
        });
      }

      // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²´í¬ (ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš°)
      auth.onAuthStateChanged((user) => {
        if (user) {
          user.getIdToken().then((idToken) => {
            console.log("Already logged in, redirecting...");
            redirectToStreamlit(idToken);
          });
        }
      });
    </script>
  </body>
</html>
