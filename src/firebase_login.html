<!-- firebase_login.html -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Firebase Login</title>
    <!-- Firebase SDK 스크립트 로드 -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script type="text/javascript">
      // Firebase 구성 정보를 .env 파일의 값으로 대체해야 합니다.
      const firebaseConfig = {
        apiKey: "{{FIREBASE_API_KEY}}",
        authDomain: "{{FIREBASE_AUTH_DOMAIN}}",
        projectId: "{{FIREBASE_PROJECT_ID}}",
        storageBucket: "{{FIREBASE_STORAGE_BUCKET}}",
        messagingSenderId: "{{FIREBASE_MESSAGING_SENDER_ID}}",
        appId: "{{FIREBASE_APP_ID}}",
      };

      // Firebase 초기화
      firebase.initializeApp(firebaseConfig);

      function signInWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        // 이메일 도메인 제한 (선택 사항)
        provider.setCustomParameters({
          hd: "jeohyeon.hs.kr",
        });
        firebase
          .auth()
          .signInWithPopup(provider)
          .then((result) => {
            // Google 로그인 성공
            return result.user.getIdToken(/* forceRefresh */ true);
          })
          .then((idToken) => {
            // 획득한 ID 토큰을 부모 창(Streamlit)으로 전송
            window.parent.postMessage(
              {
                type: "FIREBASE_ID_TOKEN",
                token: idToken,
              },
              "*"
            );
          })
          .catch((error) => {
            console.error("로그인 실패:", error);
            window.parent.postMessage(
              {
                type: "FIREBASE_LOGIN_ERROR",
                error: error.message,
              },
              "*"
            );
          });
      }
    </script>
  </head>
  <body>
    <button
      onclick="signInWithGoogle()"
      style="padding: 10px 20px; font-size: 16px; cursor: pointer"
    >
      Google 계정으로 로그인
    </button>
  </body>
</html>
